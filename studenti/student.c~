#include<stdio.h>
#include<stdlib.h>
#include<string.h>
struct student
{
  char ime[ 10 ] ;
  char prezime[ 20 ] ;
  char index[ 10 ] ;
  int ocene[ 6 ] ;
} ;

int mainMenu( )
{
  int i = 0 ;
  while( 1 )
  {
    printf( "-----Studentation-----\n\n" ) ;
    printf( "  1. Izlistavanje studenta.\n  2. Pretrazivanje studenta po prezimenu.\n  3. Unos novog studenta.\n  4. Izlaz.\n" ) ;
    printf( "Vas unos: " ) ;
    scanf( "%d", &i ) ;

    if( i < 1 || i > 5 )
      printf( "Nekorektan unos!\n" ) ;
    else
      break ;
  }
  return i ;
}

void newStudent( )
{
  FILE* file ;
  struct student s ;
  int i ;
  int temp ;
  char student[ 100 ]  ;
  
  printf("Unosenje podataka o studentu...\nNaponema: prilikom unosa ocena bilo koji broj van opsega 5-10 prekida unoss!\nIme: " ) ;
  scanf( "%s", s.ime ) ;

  printf( "Prezime: " ) ;
  scanf( "%s", s.prezime ) ;

  printf( "Index: " ) ;
  scanf( "%s", s.index ) ;

  printf( "Ocene: " ) ;
  for( i = 0 ; i < sizeof( s.ocene ) / 4 ; ++i )
  {
    scanf( "%d", &temp ) ;
    if( temp >= 5 && temp <= 10 )
      s.ocene[ i ] = temp ;
    else
      break ;    
  }
  printf( "\nNovi student kreiran, dodajem u bazu podataka\n" ) ;

  //file = fopen( "/tmp/studenti.dat", "a+" ) ;
  strcat( student, strcat( s.ime, strcat( ";", s.prezime ))) ;
//  strcat( student, strcat( s.ime, strcat( ";", strcat( s.prezime, strcat( ";", strcat( s.index, ";" )))))) ;
  printf( "%s", student ) ;
  //fputs( "\n", file ) ;
  //fclose( file ) ;
}

void toDataBase( struct student *s )
{
  
}

void fromDataBase( )
{
  FILE* file ;
  char* studentInfo ;
  char* studentLine ;
  size_t nob = 0 ;

  if(( file = fopen( "/tmp/studenti.dat", "r+" )) == NULL )
    printf( "Could not open file!\n" ) ;
  printf( "\nIzlistavanje studenata...\n\n" ) ;

  studentLine = ( char* ) malloc( 50 ) ;
  studentInfo = ( char* ) malloc( 20 ) ;
  
  do
  {
    getline( &studentLine, &nob, file ) ;
    studentInfo = strtok( studentLine, ";" ) ;
    printf( "Ime:%s\n", studentInfo ) ;

    studentInfo = strtok( NULL, ";" ) ;
    printf( "Prezime:%s\n", studentInfo ) ;

    studentInfo = strtok( NULL, ";" ) ;
    printf( "Index:%s\n", studentInfo ) ;

    studentInfo = strtok( NULL, ";" ) ;
    printf( "Ocene:%s\n", studentInfo ) ;
  } while( !feof( file )) ;

  printf( "\nIzlistavanje zavrseno.\n\n" ) ;
  
}

void searchBySurname( char* prezime )
{

}



int main( )
{
  struct student s ;
  FILE* studFile ;
  int menuChoise = 0 ;
  char* prezime ;
  
  
  while( 1 )
  {
    menuChoise = mainMenu( ) ;
    if( menuChoise == 1 )
    {
      fromDataBase( ) ;
    }
    else if( menuChoise == 2 ) // pretraga po prezimenu
    {
      printf( "Uneti prezime za pretragu: " ) ;
      scanf( "%s", prezime ) ;
    }
    else if( menuChoise == 3 )
    {
      newStudent( ) ;
    }
    else if( menuChoise == 4 ) // Sacuvati sve i zatvoriti program... /tmp/studenti.dat
    {
      break ;
    }
  }
  return 0 ;
}

